<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goals - Second Brain</title>
    <link rel="stylesheet" href="styles.css?v=solid">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-container" style="animation: fadeIn var(--anim-duration) ease;">
        <div class="page-header card-premium" style="padding: 20px; border-radius: 16px; margin-bottom: 24px;">
            <h1 style="margin: 0;">üéØ Goals</h1>
            <div class="flex gap-2">
                <button class="btn btn-primary" onclick="openAddModal()">+ Add Goal</button>
                <a href="index.html" class="back-button">‚Üê Dashboard</a>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="goals-stats">
            <div class="stat-card">
                <div class="stat-icon" style="background: #e3f2fd; color: #1976d2;">üéØ</div>
                <div class="stat-info">
                    <h3 id="statTotal">0</h3>
                    <p>Total Goals</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: #fff3e0; color: #f57c00;">‚ö°</div>
                <div class="stat-info">
                    <h3 id="statProgress">0</h3>
                    <p>In Progress</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: #e8f5e9; color: #388e3c;">‚úÖ</div>
                <div class="stat-info">
                    <h3 id="statCompleted">0</h3>
                    <p>Completed</p>
                </div>
            </div>
        </div>

        <div class="view-controls">
            <div class="view-tabs" id="viewTabs">
                <button class="view-tab" data-view="year">üéØ 2026 Goals</button>
                <button class="view-tab" data-view="quarter">üìÖ Quarterly Goals</button>
                <button class="view-tab" data-view="completed">‚úÖ Completed</button>
            </div>
            <input type="text" id="searchInput" class="form-input search-box" placeholder="Search goals...">
        </div>

        <div id="goalsContainer" class="goals-grid"></div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal-overlay" id="goalModal">
        <div class="modal card-premium">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add Goal</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <form id="goalForm">
                <div class="form-group">
                    <label class="form-label">Goal</label>
                    <input type="text" name="goal" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select name="category" class="form-select" required>
                        <option value="">Select category</option>
                        <option value="Career">Career</option>
                        <option value="Finance">Finance</option>
                        <option value="Health">Health</option>
                        <option value="Personal">Personal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Timeframe</label>
                    <select name="timeframe" class="form-select" required>
                        <option value="">Select timeframe</option>
                        <option value="Year">Year</option>
                        <option value="Quarter">Quarter</option>
                        <option value="Month">Month</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select" required>
                        <option value="Not Started">Not Started</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Done">Done</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select name="priority" class="form-select" required>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Goal</button>
                </div>
            </form>
        </div>
    </div>

    <script src="data-manager.js"></script>
    <script src="app.js"></script>
    <script>
        let currentView = 'year';
        let searchQuery = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupViewTabs();
            setupSearch();
            setupForm();
            renderGoals();

            // Real-time synchronization!
            dataManager.onUpdate((db) => {
                if (!db || db === 'goals') renderGoals();
            });
        });

        function setupViewTabs() {
            const tabs = document.querySelectorAll('.view-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentView = tab.dataset.view;
                    renderGoals();
                });
            });
            tabs[0]?.classList.add('active');
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', utils.debounce((e) => {
                searchQuery = e.target.value.toLowerCase();
                renderGoals();
            }, 300));
        }

        function setupForm() {
            const form = document.getElementById('goalForm');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                if (form.dataset.editId) {
                    dataManager.updateItem('goals', form.dataset.editId, data);
                    showToast('Goal updated successfully!');
                } else {
                    dataManager.addItem('goals', data);
                    showToast('Goal added successfully!');
                }

                closeModal();
            });
        }

        function updateStats(goals) {
            document.getElementById('statTotal').textContent = goals.length;
            document.getElementById('statProgress').textContent = goals.filter(g => g.status === 'In Progress').length;
            document.getElementById('statCompleted').textContent = goals.filter(g => g.status === 'Done').length;
        }

        function getProgressColor(status) {
            if (status === 'Done') return '#4caf50';
            if (status === 'In Progress') return '#ff9800';
            return '#e0e0e0';
        }

        function getProgressWidth(status) {
            if (status === 'Done') return '100%';
            if (status === 'In Progress') return '50%';
            return '0%';
        }

        function renderGoals() {
            let allGoals = dataManager.getData('goals');
            updateStats(allGoals);

            let goals = allGoals;

            // Filter by view
            if (currentView === 'year') {
                goals = goals.filter(g => g.timeframe === 'Year');
            } else if (currentView === 'quarter') {
                goals = goals.filter(g => g.timeframe === 'Quarter');
            } else if (currentView === 'completed') {
                goals = goals.filter(g => g.status === 'Done');
            }

            // Filter by search
            if (searchQuery) {
                goals = goals.filter(g =>
                    g.goal?.toLowerCase().includes(searchQuery) ||
                    g.category?.toLowerCase().includes(searchQuery)
                );
            }

            const container = document.getElementById('goalsContainer');

            if (goals.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">No goals found. Add your first goal!</div>';
                return;
            }

            let html = '';
            goals.forEach(goal => {
                const progressColor = getProgressColor(goal.status);
                const progressWidth = getProgressWidth(goal.status);

                html += `
                    <div class="goal-card">
                        <div class="goal-header">
                            <h3 class="goal-title">${utils.escapeHtml(goal.goal)}</h3>
                            ${priorityBadge(goal.priority)}
                        </div>
                        
                        <div class="goal-progress-container">
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill" style="width: ${progressWidth}; background: ${progressColor}"></div>
                            </div>
                            <div class="flex justify-between" style="font-size: 12px; color: #666;">
                                <span>${goal.status}</span>
                                <span>${progressWidth}</span>
                            </div>
                        </div>

                        <div class="goal-footer">
                            <div class="goal-meta">
                                ${createBadge(goal.category, 'status-not-started')}
                                <span>üìÖ ${goal.timeframe}</span>
                            </div>
                            <div class="goal-actions">
                                <button class="btn btn-xs btn-secondary" onclick="editGoal('${goal.id}')">Edit</button>
                                <button class="btn btn-xs btn-danger" onclick="deleteGoal('${goal.id}')">Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add Goal';
            document.getElementById('goalForm').reset();
            delete document.getElementById('goalForm').dataset.editId;
            document.getElementById('goalModal').classList.add('active');
        }

        function editGoal(id) {
            const goal = dataManager.getItemById('goals', id);
            if (!goal) return;

            document.getElementById('modalTitle').textContent = 'Edit Goal';
            const form = document.getElementById('goalForm');
            form.dataset.editId = id;

            form.elements.goal.value = goal.goal;
            form.elements.category.value = goal.category;
            form.elements.timeframe.value = goal.timeframe;
            form.elements.status.value = goal.status;
            form.elements.priority.value = goal.priority;

            document.getElementById('goalModal').classList.add('active');
        }

        async function deleteGoal(id) {
            if (await confirmDelete('Are you sure you want to delete this goal?')) {
                dataManager.deleteItem('goals', id);
                showToast('Goal deleted successfully!');
                renderGoals();
            }
        }

        function closeModal() {
            document.getElementById('goalModal').classList.remove('active');
            document.getElementById('goalForm').reset();
            delete document.getElementById('goalForm').dataset.editId;
        }
    </script>
</body>

</html>